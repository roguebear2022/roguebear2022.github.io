<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±åœ³å…»è€é‡‘ç²¾ç¡®æµ‹ç®—å·¥å…·</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            margin: -30px -30px 30px -30px;
            padding: 30px;
            border-radius: 15px 15px 0 0;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .data-management {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .data-management h3 {
            margin-bottom: 15px;
            color: #2e7d32;
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }
        
        .data-management h3::before {
            content: "ğŸ’¾";
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .data-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .data-buttons button {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .data-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .save-btn { 
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        .load-btn { 
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        .export-btn { 
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
        }
        .import-btn { 
            background: linear-gradient(135deg, #607D8B, #455A64);
            color: white;
        }
        
        .file-input { display: none; }
        
        .input-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .section-help {
            background: linear-gradient(135deg, #fff3cd, #ffecb3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .control-group input, .control-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .control-group input:focus, .control-group select:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .action-buttons button {
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .action-buttons button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .add-year-btn {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
            color: white;
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .years-container {
            margin-top: 30px;
        }
        
        .year-section {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .year-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .year-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            padding: 15px 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 10px 10px 0 0;
            border-bottom: 2px solid #ced4da;
        }
        
        .year-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .remove-year-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .remove-year-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
        }
        
        .year-controls {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .year-control-item {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .year-control-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .year-control-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 6px;
            text-align: center;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .year-control-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        .months-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .month-item {
            display: flex;
            flex-direction: column;
            padding: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-width: 0;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .month-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }
        
        .month-header {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            font-size: 0.95rem;
            color: #2c3e50;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .month-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .month-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
            transition: border 0.3s;
        }
        
        .month-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 3px rgba(76, 175, 80, 0.3);
        }
        
        .input-label {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-bottom: 3px;
            font-weight: 500;
        }
        
        .auto-calc-btn {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            margin-top: 8px;
            width: 100%;
            transition: all 0.3s;
        }
        
        .auto-calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
        }
        
        .result {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f9f9f9, #e8f4fd);
            border-left: 5px solid #4CAF50;
            border-radius: 10px;
            display: none;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
            font-size: 1.8rem;
            text-align: center;
        }
        
        .summary {
            background: linear-gradient(135deg, #e8f4fd, #bbdefb);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .summary p {
            margin: 12px 0;
            font-size: 1.1rem;
        }
        
        .pension-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .pension-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            border-top: 4px solid #4CAF50;
        }
        
        .pension-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .pension-item h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
        }
        
        .pension-amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4CAF50;
            text-align: center;
            margin: 15px 0;
        }
        
        footer {
            margin-top: 40px;
            text-align: center;
            color: #7f8c8d;
            font-size: 1rem;
            padding-top: 25px;
            border-top: 2px solid #eaeaea;
        }
        
        @media (max-width: 1400px) {
            .months-container {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .months-container {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .year-controls {
                flex-direction: column;
                gap: 20px;
            }
            
            .data-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .months-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .pension-breakdown {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .months-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .container {
                padding: 15px;
            }
            
            header {
                padding: 20px 15px;
                margin: -15px -15px 20px -15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ·±åœ³å…»è€é‡‘ç²¾ç¡®æµ‹ç®—å·¥å…·</h1>
            <p class="subtitle">åŸºäºæœˆåº¦ç¼´è´¹åŸºæ•°å’Œä¸ªäººç¼´è´¹çš„ç²¾ç¡®å…»è€é‡‘è®¡ç®—å™¨ï¼ˆå†…ç½®æ·±åœ³æ•°æ®ï¼‰</p>
        </header>
        
        <div class="data-management">
            <h3>æ•°æ®ç®¡ç†</h3>
            <p>ä¿å­˜æ‚¨çš„ç¼´è´¹æ•°æ®ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç»§ç»­ä½¿ç”¨æˆ–åœ¨ä¸åŒè®¾å¤‡é—´è¿ç§»</p>
            <div class="data-buttons">
                <button class="save-btn" onclick="saveData()">ğŸ’¾ ä¿å­˜æ•°æ®åˆ°æœ¬åœ°</button>
                <button class="load-btn" onclick="loadData()">ğŸ“‚ ä»æœ¬åœ°åŠ è½½æ•°æ®</button>
                <button class="export-btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®æ–‡ä»¶</button>
                <button class="import-btn" onclick="document.getElementById('fileInput').click()">ğŸ“¥ å¯¼å…¥æ•°æ®æ–‡ä»¶</button>
                <input type="file" id="fileInput" class="file-input" accept=".json" onchange="importData(event)">
            </div>
            <div class="input-help">æ•°æ®å°†ä¿å­˜åœ¨æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼Œæ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±ä¿å­˜çš„ä¿¡æ¯</div>
        </div>
        
        <div class="section-help">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ul>
                <li>è®¾ç½®èµ·å§‹å¹´ä»½å’Œé€€ä¼‘å¹´é¾„ï¼ˆé»˜è®¤èµ·å§‹å¹´ä»½ä¸º1965å¹´ï¼‰</li>
                <li>ç‚¹å‡»"æ·»åŠ æ–°ä¸€å¹´æ•°æ®"æ·»åŠ å¹´ä»½</li>
                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨å¡«å……æ·±åœ³çš„ç¤¾ä¼šå¹³å‡å·¥èµ„å’Œåˆ©ç‡æ•°æ®ï¼ˆ2000-2024å¹´ï¼‰</li>
                <li>ä¸ºæ¯ä¸€å¹´è¾“å…¥æ¯ä¸ªæœˆçš„ç¼´è´¹åŸºæ•°å’Œä¸ªäººç¼´è´¹é‡‘é¢</li>
                <li>ç‚¹å‡»"è‡ªåŠ¨è®¡ç®—"æŒ‰é’®å¯æ ¹æ®ç¼´è´¹åŸºæ•°è‡ªåŠ¨è®¡ç®—ä¸ªäººç¼´è´¹ï¼ˆ8%ï¼‰</li>
                <li>ç‚¹å‡»"ç²¾ç¡®è®¡ç®—å…»è€é‡‘"è·å–ç»“æœ</li>
                <li>ä½¿ç”¨æ•°æ®ç®¡ç†åŠŸèƒ½ä¿å­˜æˆ–åŠ è½½æ‚¨çš„ç¼´è´¹æ•°æ®</li>
            </ul>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="startYear">èµ·å§‹å¹´ä»½:</label>
                <input type="number" id="startYear" value="1965" min="1965" max="2050">
            </div>
            
            <div class="control-group">
                <label for="retirementAge">é¢„è®¡é€€ä¼‘å¹´é¾„:</label>
                <select id="retirementAge">
                    <option value="139">60å²</option>
                    <option value="170">55å²</option>
                    <option value="195">50å²</option>
                </select>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="add-year-btn" onclick="addYear()">æ·»åŠ æ–°ä¸€å¹´æ•°æ®</button>
            <button class="calculate-btn" onclick="calculateMonthlyPension()">ç²¾ç¡®è®¡ç®—å…»è€é‡‘</button>
        </div>

        <div id="yearsContainer" class="years-container"></div>

        <div id="result" class="result">
            <h3>å…»è€é‡‘æµ‹ç®—ç»“æœ</h3>
            <div class="summary">
                <p><strong>è®¡å‘æœˆæ•°:</strong> <span id="totalMonths">0</span> ä¸ªæœˆ</p>
                <p><strong>ä¸ªäººç¼´è´¹æ€»é¢:</strong> <span id="totalPersonalContribution">0</span> å…ƒ</p>
                <p><strong>ä¸ªäººè´¦æˆ·æœ€ç»ˆä½™é¢:</strong> <span id="finalBalance">0</span> å…ƒ</p>
                <p><strong>åˆ©æ¯æ”¶ç›Š:</strong> <span id="totalInterest">0</span> å…ƒ</p>
                <p><strong>æœ¬äººå¹³å‡ç¼´è´¹æŒ‡æ•°:</strong> <span id="avgIndex">0</span></p>
            </div>
            
            <div class="pension-breakdown">
                <div class="pension-item">
                    <h4>åŸºç¡€å…»è€é‡‘</h4>
                    <div class="pension-amount"><span id="basicPension">0</span> å…ƒ/æœˆ</div>
                    <p>(é€€ä¼‘æ—¶ç¤¾å¹³å·¥èµ„ + æœ¬äººæŒ‡æ•°åŒ–æœˆå¹³å‡ç¼´è´¹å·¥èµ„) Ã· 2 Ã— æ€»ç¼´è´¹å¹´é™ Ã— 1%</p>
                </div>
                
                <div class="pension-item">
                    <h4>ä¸ªäººè´¦æˆ·å…»è€é‡‘</h4>
                    <div class="pension-amount"><span id="personalPension">0</span> å…ƒ/æœˆ</div>
                    <p>ä¸ªäººè´¦æˆ·æ€»é¢ Ã· è®¡å‘æœˆæ•°</p>
                </div>
                
                <div class="pension-item">
                    <h4>æ€»è®¡æ¯æœˆå…»è€é‡‘</h4>
                    <div class="pension-amount"><span id="totalPension">0</span> å…ƒ/æœˆ</div>
                    <p>åŸºç¡€å…»è€é‡‘ + ä¸ªäººè´¦æˆ·å…»è€é‡‘</p>
                </div>
            </div>
            
            <div class="input-help" style="margin-top: 20px;">
                è¯´æ˜ï¼šæ­¤è®¡ç®—åŸºäºæ‚¨è¾“å…¥çš„æœˆåº¦æ•°æ®ï¼Œå¹¶è€ƒè™‘äº†ä¸ªäººè´¦æˆ·çš„æŒ‰å¹´å¤åˆ©ç´¯ç§¯ï¼Œç»“æœéå¸¸æ¥è¿‘å®é™…å€¼ã€‚
            </div>
        </div>
        
        <footer>
            <p>æ·±åœ³å…»è€é‡‘ç²¾ç¡®æµ‹ç®—å·¥å…· &copy; 2023 | æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå®é™…é‡‘é¢ä»¥ç¤¾ä¿éƒ¨é—¨æ ¸ç®—ä¸ºå‡†</p>
        </footer>
    </div>

    <script>
        let currentYears = [];
        
        // æ·±åœ³ç¤¾ä¼šå¹³å‡å·¥èµ„å†å²æ•°æ®ï¼ˆ2000-2024å¹´ï¼‰
        const shenzhenAvgSalary = {
            2000: 1920, 2001: 2162, 2002: 2353, 2003: 2551, 2004: 2661,
            2005: 2706, 2006: 2928, 2007: 3226, 2008: 3620, 2009: 3906,
            2010: 4206, 2011: 4633, 2012: 4918, 2013: 5218, 2014: 6054,
            2015: 6753, 2016: 7480, 2017: 8348, 2018: 9309, 2019: 10646,
            2020: 11620, 2021: 12964, 2022: 13730, 2023: 14553, 2024: 14755
        };
        
        // æ·±åœ³å…»è€ä¿é™©ä¸ªäººè´¦æˆ·å†å¹´åˆ©ç‡ï¼ˆ2000-2024å¹´ï¼‰
        const shenzhenInterestRate = {
            2000: 2.25, 2001: 2.25, 2002: 2.25, 2003: 2.25, 2004: 2.25,
            2005: 2.25, 2006: 2.52, 2007: 3.21, 2008: 3.92, 2009: 2.25,
            2010: 2.75, 2011: 3.50, 2012: 3.50, 2013: 3.50, 2014: 3.50,
            2015: 3.50, 2016: 8.31, 2017: 7.12, 2018: 8.29, 2019: 7.61,
            2020: 6.04, 2021: 6.69, 2022: 6.12, 2023: 5.94, 2024: 6.00
        };
        
        // æ•°æ®ç®¡ç†åŠŸèƒ½
        function saveData() {
            const data = collectAllData();
            localStorage.setItem('pensionCalculatorData', JSON.stringify(data));
            alert('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼');
        }
        
        function loadData() {
            const savedData = localStorage.getItem('pensionCalculatorData');
            if (savedData) {
                if (confirm('æ˜¯å¦åŠ è½½ä¹‹å‰ä¿å­˜çš„æ•°æ®ï¼Ÿå½“å‰æœªä¿å­˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚')) {
                    const data = JSON.parse(savedData);
                    restoreData(data);
                    alert('æ•°æ®åŠ è½½æˆåŠŸï¼');
                }
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ•°æ®ï¼');
            }
        }
        
        function exportData() {
            const data = collectAllData();
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å…»è€é‡‘æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼');
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm('æ˜¯å¦å¯¼å…¥æ•°æ®æ–‡ä»¶ï¼Ÿå½“å‰æœªä¿å­˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚')) {
                        restoreData(data);
                        alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    }
                } catch (error) {
                    alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„JSONæ•°æ®æ–‡ä»¶ï¼');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
        }
        
        function collectAllData() {
            const data = {
                startYear: document.getElementById('startYear').value,
                retirementAge: document.getElementById('retirementAge').value,
                years: []
            };
            
            currentYears.forEach(year => {
                const yearData = {
                    year: year,
                    avgSalary: document.getElementById(`avgSalary_${year}`).value,
                    interestRate: document.getElementById(`interestRate_${year}`).value,
                    months: []
                };
                
                for (let month = 1; month <= 12; month++) {
                    const salaryInput = document.getElementById(`salary_${year}_${month}`);
                    const personalInput = document.getElementById(`personal_${year}_${month}`);
                    
                    if (salaryInput && personalInput) {
                        yearData.months.push({
                            month: month,
                            salary: salaryInput.value,
                            personal: personalInput.value
                        });
                    }
                }
                
                data.years.push(yearData);
            });
            
            return data;
        }
        
        function restoreData(data) {
            // æ¸…é™¤ç°æœ‰æ•°æ®
            document.getElementById('yearsContainer').innerHTML = '';
            currentYears = [];
            
            // æ¢å¤åŸºæœ¬è®¾ç½®
            document.getElementById('startYear').value = data.startYear || 1965;
            document.getElementById('retirementAge').value = data.retirementAge || '139';
            
            // æ¢å¤å¹´ä»½æ•°æ®
            if (data.years && data.years.length > 0) {
                data.years.forEach(yearData => {
                    addYear();
                    const currentYear = currentYears[currentYears.length - 1];
                    
                    // è®¾ç½®ç¤¾ä¼šå¹³å‡å·¥èµ„
                    const avgSalaryInput = document.getElementById(`avgSalary_${currentYear}`);
                    if (avgSalaryInput && yearData.avgSalary) {
                        avgSalaryInput.value = yearData.avgSalary;
                    }
                    
                    // è®¾ç½®åˆ©ç‡
                    const interestRateInput = document.getElementById(`interestRate_${currentYear}`);
                    if (interestRateInput && yearData.interestRate) {
                        interestRateInput.value = yearData.interestRate;
                    }
                    
                    // è®¾ç½®æœˆåº¦æ•°æ®
                    if (yearData.months) {
                        yearData.months.forEach(monthData => {
                            const salaryInput = document.getElementById(`salary_${currentYear}_${monthData.month}`);
                            const personalInput = document.getElementById(`personal_${currentYear}_${monthData.month}`);
                            
                            if (salaryInput && personalInput) {
                                salaryInput.value = monthData.salary || '0';
                                personalInput.value = monthData.personal || '0';
                            }
                        });
                    }
                });
            }
        }
        
        function addYear() {
            const startYear = parseInt(document.getElementById('startYear').value);
            const year = startYear + currentYears.length;
            
            // è·å–æ·±åœ³æ•°æ®
            const avgSalary = shenzhenAvgSalary[year] || 0;
            const interestRate = shenzhenInterestRate[year] || 0;
            
            const yearSection = document.createElement('div');
            yearSection.className = 'year-section';
            yearSection.innerHTML = `
                <div class="year-header">
                    <div class="year-title">${year}å¹´</div>
                    <button class="remove-year-btn" onclick="this.parentElement.parentElement.remove(); updateYearSequence()">åˆ é™¤è¯¥å¹´</button>
                </div>
                
                <div class="year-controls">
                    <div class="year-control-item">
                        <div class="year-control-label">ç¤¾ä¼šå¹³å‡å·¥èµ„(å…ƒ):</div>
                        <input type="number" class="year-control-input" id="avgSalary_${year}" value="${avgSalary}" min="0" step="100">
                        <div class="input-help">${year}å¹´åº¦æ·±åœ³å¸‚åœ¨å²—èŒå·¥æœˆå¹³å‡å·¥èµ„</div>
                    </div>
                    
                    <div class="year-control-item">
                        <div class="year-control-label">æœ¬å¹´åº¦åˆ©ç‡(%):</div>
                        <input type="number" class="year-control-input" id="interestRate_${year}" value="${interestRate}" min="0" step="0.01">
                        <div class="input-help">${year}å¹´åº¦æ·±åœ³å¸‚å…»è€ä¿é™©ä¸ªäººè´¦æˆ·åˆ©ç‡</div>
                    </div>
                </div>
                
                <div>
                    <div style="font-weight: bold; margin-bottom: 10px;">${year}å¹´å„æœˆç¼´è´¹æ•°æ®:</div>
                    <div class="months-container" id="months_${year}">
                        ${generateMonthInputs(year)}
                    </div>
                    <div class="input-help">è¯·è¾“å…¥æ¯ä¸ªæœˆçš„å®é™…ç¼´è´¹åŸºæ•°å’Œä¸ªäººç¼´è´¹é‡‘é¢</div>
                </div>
            `;
            
            document.getElementById('yearsContainer').appendChild(yearSection);
            currentYears.push(year);
            
            // ä¸ºæ–°å¢å¹´ä»½çš„æ‰€æœ‰æœˆä»½æ·»åŠ è‡ªåŠ¨è®¡ç®—äº‹ä»¶
            setTimeout(() => {
                for (let month = 1; month <= 12; month++) {
                    const baseInput = document.getElementById(`salary_${year}_${month}`);
                    if (baseInput) {
                        baseInput.addEventListener('input', function() {
                            autoCalculatePersonalContribution(year, month);
                        });
                    }
                }
            }, 100);
        }
        
        function autoCalculatePersonalContribution(year, month) {
            const baseInput = document.getElementById(`salary_${year}_${month}`);
            const personalInput = document.getElementById(`personal_${year}_${month}`);
            
            if (baseInput && personalInput) {
                const baseSalary = parseFloat(baseInput.value) || 0;
                // è‡ªåŠ¨è®¡ç®—ä¸ªäººç¼´è´¹ï¼ˆåŸºæ•°çš„8%ï¼‰
                const personalContribution = baseSalary * 0.08;
                personalInput.value = personalContribution.toFixed(2);
            }
        }
        
        function generateMonthInputs(year) {
            const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
            let html = '';
            
            // è®¾ç½®é»˜è®¤ç¼´è´¹åŸºæ•°ï¼ˆç¤¾å¹³å·¥èµ„çš„80%ï¼‰
            const defaultSalary = Math.round((shenzhenAvgSalary[year] || 10000) * 0.8);
            const defaultPersonal = (defaultSalary * 0.08).toFixed(2);
            
            months.forEach((month, index) => {
                html += `
                    <div class="month-item">
                        <div class="month-header">${month}</div>
                        <div class="month-input-group">
                            <div class="input-label">ç¼´è´¹åŸºæ•°</div>
                            <input type="number" class="month-input" id="salary_${year}_${index + 1}" placeholder="åŸºæ•°" value="${defaultSalary}" min="0" step="100">
                            
                            <div class="input-label">ä¸ªäººç¼´è´¹</div>
                            <input type="number" class="month-input" id="personal_${year}_${index + 1}" placeholder="ä¸ªäººç¼´è´¹" value="${defaultPersonal}" min="0" step="0.01">
                            
                            <button class="auto-calc-btn" onclick="autoCalculatePersonalContribution(${year}, ${index + 1})">è‡ªåŠ¨è®¡ç®—(8%)</button>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function updateYearSequence() {
            // é‡æ–°è®¡ç®—å½“å‰æ˜¾ç¤ºçš„å¹´ä»½åºåˆ—
            currentYears = [];
            const yearSections = document.querySelectorAll('.year-section');
            yearSections.forEach(section => {
                const yearText = section.querySelector('.year-title').textContent;
                const year = parseInt(yearText);
                currentYears.push(year);
            });
        }
        
        function calculateMonthlyPension() {
            if (currentYears.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€å¹´çš„æ•°æ®ï¼');
                return;
            }
            
            // æ”¶é›†æ‰€æœ‰æ•°æ®
            const monthlyData = [];
            let totalMonths = 0;
            let totalIndex = 0;
            let personalAccountBalance = 0;
            let totalPersonalContribution = 0;
            
            // æŒ‰å¹´ä»½å’Œæœˆä»½å¤„ç†æ•°æ®
            currentYears.forEach(year => {
                const avgSalaryInput = document.getElementById(`avgSalary_${year}`);
                const interestRateInput = document.getElementById(`interestRate_${year}`);
                const avgSalary = parseFloat(avgSalaryInput.value) || 0;
                const interestRate = parseFloat(interestRateInput.value) || 0;
                
                // æ£€æŸ¥ç¤¾ä¼šå¹³å‡å·¥èµ„æ˜¯å¦ä¸º0
                if (avgSalary <= 0) {
                    alert(`${year}å¹´çš„ç¤¾ä¼šå¹³å‡å·¥èµ„ä¸èƒ½ä¸º0ï¼Œè¯·å¡«å†™æ­£ç¡®çš„æ•°å€¼ï¼`);
                    avgSalaryInput.focus();
                    return;
                }
                
                let yearPersonalContribution = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const salaryInput = document.getElementById(`salary_${year}_${month}`);
                    const personalInput = document.getElementById(`personal_${year}_${month}`);
                    
                    if (salaryInput && personalInput) {
                        const monthSalary = parseFloat(salaryInput.value) || 0;
                        const personalContribution = parseFloat(personalInput.value) || 0;
                        
                        if (monthSalary > 0) {
                            // è®¡ç®—å½“æœˆç¼´è´¹æŒ‡æ•°ï¼ˆé¿å…é™¤ä»¥0ï¼‰
                            const monthIndex = monthSalary / avgSalary;
                            totalIndex += monthIndex;
                            totalMonths++;
                            totalPersonalContribution += personalContribution;
                            yearPersonalContribution += personalContribution;
                            
                            monthlyData.push({
                                year,
                                month,
                                salary: monthSalary,
                                personalContribution: personalContribution,
                                avgSalary,
                                index: monthIndex
                            });
                        }
                    }
                }
                
                // æŒ‰å¹´å¤åˆ©è®¡ç®—ä¸ªäººè´¦æˆ·
                if (yearPersonalContribution > 0) {
                    personalAccountBalance = personalAccountBalance * (1 + interestRate / 100) + yearPersonalContribution;
                }
            });
            
            if (totalMonths === 0) {
                alert('æ²¡æœ‰æœ‰æ•ˆçš„ç¼´è´¹æ•°æ®ï¼');
                return;
            }
            
            // è®¡ç®—å…»è€é‡‘
            const avgIndex = totalIndex / totalMonths;
            const retirementMonths = parseInt(document.getElementById('retirementAge').value);
            const totalInterest = personalAccountBalance - totalPersonalContribution;
            
            // ä½¿ç”¨æœ€åä¸€å¹´çš„ç¤¾ä¼šå¹³å‡å·¥èµ„ä½œä¸ºé€€ä¼‘æ—¶ä¸Šå¹´åº¦ç¤¾å¹³å·¥èµ„
            const lastYear = currentYears[currentYears.length - 1];
            const finalAvgSalaryInput = document.getElementById(`avgSalary_${lastYear}`);
            const finalAvgSalary = parseFloat(finalAvgSalaryInput.value) || 0;
            
            // æ£€æŸ¥é€€ä¼‘æ—¶ç¤¾å¹³å·¥èµ„æ˜¯å¦ä¸º0
            if (finalAvgSalary <= 0) {
                alert(`é€€ä¼‘å¹´ä»½${lastYear}çš„ç¤¾ä¼šå¹³å‡å·¥èµ„ä¸èƒ½ä¸º0ï¼Œè¯·å¡«å†™æ­£ç¡®çš„æ•°å€¼ï¼`);
                finalAvgSalaryInput.focus();
                return;
            }
            
            // åŸºç¡€å…»è€é‡‘
            const indexedAvgSalary = finalAvgSalary * avgIndex;
            const basicPension = (finalAvgSalary + indexedAvgSalary) / 2 * (totalMonths / 12) * 0.01;
            
            // ä¸ªäººè´¦æˆ·å…»è€é‡‘
            const personalPension = personalAccountBalance / retirementMonths;
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('totalMonths').textContent = totalMonths;
            document.getElementById('totalPersonalContribution').textContent = totalPersonalContribution.toFixed(2);
            document.getElementById('finalBalance').textContent = personalAccountBalance.toFixed(2);
            document.getElementById('totalInterest').textContent = totalInterest.toFixed(2);
            document.getElementById('avgIndex').textContent = avgIndex.toFixed(4);
            document.getElementById('basicPension').textContent = basicPension.toFixed(2);
            document.getElementById('personalPension').textContent = personalPension.toFixed(2);
            document.getElementById('totalPension').textContent = (basicPension + personalPension).toFixed(2);
            
            document.getElementById('result').style.display = 'block';
        }
        
        // åˆå§‹æ·»åŠ ä¸€å¹´æ•°æ®
        window.onload = function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„æ•°æ®
            const savedData = localStorage.getItem('pensionCalculatorData');
            if (savedData) {
                if (confirm('æ£€æµ‹åˆ°æœ‰ä¿å­˜çš„æ•°æ®ï¼Œæ˜¯å¦åŠ è½½ï¼Ÿ')) {
                    const data = JSON.parse(savedData);
                    restoreData(data);
                } else {
                    addYear();
                }
            } else {
                addYear();
            }
        };
    </script>
</body>
</html>